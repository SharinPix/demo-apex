<apex:page standardController="Account" extensions="VFC01_ImageTextOverlay">
   
    <script>
    
    var latestImageViewed;
    var eventMethod = window.addEventListener ? "addEventListener" : "attachEvent";
    var eventer = window[eventMethod];
    var messageEvent = eventMethod == "attachEvent" ? "onmessage" : "message";
    
    eventer(messageEvent, function(e) {
        
        console.log('Origin ->'+e.origin);
        console.log('messageEvent ->'+messageEvent);
        
        if (e.origin === 'https://app.sharinpix.com') {
            
            let data = e.data;
            
            console.log('data', e.data);
            
            switch (data.name) {
                    
                case 'viewer-image-viewed':
                    latestImageViewed = data.payload.image.public_id;
                    
                   
                    break;
                case 'viewer-closed':
                    latestImageViewed = null;
            }//end switch
            
        }//end if
        
    }, false);
    
    //OverlayText
    function overlayText(){
        
        var text = document.getElementById("j_id0:j_id2:textInput").value;
        var fontStyle = document.getElementById("j_id0:j_id2:fontStyleInput").value;
        var fontSize = document.getElementById("j_id0:j_id2:fontSizeInput").value;
        var fontEmphasis = document.getElementById("j_id0:j_id2:fontEmphasisInput").value;
        var gravity = document.getElementById("j_id0:j_id2:gravityInput").value;
		var borderWidth = document.getElementById("j_id0:j_id2:borderWidthInput").value;
        var borderStyle = document.getElementById("j_id0:j_id2:borderStyleInput").value;
        var borderColor = document.getElementById("j_id0:j_id2:borderColorInput").value;
        
          
        Visualforce.remoting.Manager.invokeAction(

            '{!$RemoteAction.VFC01_ImageTextOverlay.overlayText}',
            latestImageViewed,
            text,//text
            fontStyle,//style
            fontSize,// size of font
            fontEmphasis,//font emphasis (bold or italic)
            gravity, //gravity
            borderWidth, //border-width
            borderStyle, //border-style
            borderColor, //border-color
            
            function(result, event){
                if (event.status) {
                  
                    var WindowObjectReference = window.open(
                        result, 
                        "Image Overlay Text",
                            "menubar=yes,location=yes,resizable=yes,scrollbars=yes,status=yes");
                            
                    
                } else if (event.type === 'exception') {
                    alert(event.message);
                } else {
                    alert(event);
                }
            }, 
            {escape: true}
        );

        }//end cropFace
  
    </script>
    
  
    
    
    <apex:form >
        
        <!-- text to-be-displayed section -->
        <apex:outputText style="font-style:italic" value="Text:"></apex:outputText>
        <apex:inputText value="{!text}" id="textInput"/>
        
        <!-- font-style section -->
        <apex:outputText style="font-style:italic" value="Font Style:"></apex:outputText>
        <apex:inputText value="{!fontStyle}" id="fontStyleInput"/>
        
        <!-- font-size section -->
        <apex:outputText style="font-style:italic" value="Font-size:"></apex:outputText>
        <apex:inputText value="{!fontSize}" id="fontSizeInput"/>
        
        <!--  section font-emphasis-->
        <apex:outputText style="font-style:italic" value="Font emphasis:"></apex:outputText>
        <apex:inputText value="{!fontEmphasis}" id="fontEmphasisInput"/>
        
        <!-- gravity section -->
        <apex:outputText style="font-style:italic" value="Gravity:"></apex:outputText>
        <apex:inputText value="{!gravity}" id="gravityInput"/>
        
        <!-- border-width section -->
        <apex:outputText style="font-style:italic" value="Border-Width:"></apex:outputText>
        <apex:inputText value="{!borderWidth}" id="borderWidthInput"/>
        
        <!-- border-style section -->
        <apex:outputText style="font-style:italic" value="Border-Style:"></apex:outputText>
        <apex:inputText value="{!borderStyle}" id="borderStyleInput"/>
        
        <!-- border-color section -->
        <apex:outputText style="font-style:italic" value="Border-Color:"></apex:outputText>
        <apex:inputText value="{!borderColor}" id="borderColorInput"/>
       
        <!-- Button to initiate cropping -->
        <apex:commandButton value="Overlay Text" onclick="overlayText()" reRender="nPbt" />
        
    </apex:form>
    
    <apex:canvasApp developerName="Albums" height="500px" parameters="{!parameters}" width="100%"/>
    
</apex:page>